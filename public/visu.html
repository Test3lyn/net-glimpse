<!DOCTYPE html>
<html lang="en">

<head>
  <title>EtherVisuWeb</title>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.6/addons/p5.dom.min.js"></script>
  <script src="assets/javascripts/toxiclibs.min.js"></script>
  <script src="assets/config.js"></script>
  <script src="assets/netDataReceiver.js"></script>
  <script src="assets/graph.js"></script>
  <script src="assets/p5visu.js"></script>
  <link rel="stylesheet" media="screen" href="/assets/stylesheets/visu.css">
  <link rel="shortcut icon" type="image/png" href="/assets/images/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

  <div id="canvasContainer"></div>

  <div id="glossaryContainer">
    <div id="glossaryEther">
      <p><b>Ethernet (link color)</b></p>
      <ul id="glossaryEtherUl"></ul>
    </div>
    <div id="glossaryIp">
      <p><b>IP (link color)</b></p>
      <ul id="glossaryIpUl"></ul>
    </div>
  </div>

  <script>
    window.onresize = setCanvasAndGlossarySize;
    setCanvasAndGlossarySize();

    var glossaryEtherUl = document.getElementById("glossaryEtherUl");
    fillGlossary(glossaryEtherUl, etherTypeConfig);
    var glossaryIpUl = document.getElementById("glossaryIpUl");
    fillGlossary(glossaryIpUl, ipPacketConfig);

    // Setup ethernet visualization
    var graphEther = new Graph(configEther);
    var visuEther = new Visu(graphEther, configEther);
    var p5Ether = new p5(visuEther.s, 'canvasContainer');

    // Setup IP visualization
    var graphIp = new Graph(configIp);
    var visuIp = new Visu(graphIp, configIp);
    var p5Ip = new p5(visuIp.s, 'canvasContainer');

    netDataReceiver.start();

    function setCanvasAndGlossarySize() {
      var size = getCanvasSize();
      if (isFullscreen()) {
        document.getElementById('canvasContainer').style.marginTop = ((window.innerHeight - size) / 2) + "px";
        document.getElementById('glossaryContainer').style.display = 'none';
      } else {
        document.getElementById('canvasContainer').style.marginTop = 0 + "px";
        document.getElementById('glossaryContainer').style.display = 'block';
        document.getElementById("glossaryEther").style.width = size + "px";
        document.getElementById("glossaryIp").style.width = size + "px";
      }
      configEther.canvas.width = configEther.canvas.height = size;
      configIp.canvas.width = configIp.canvas.height = size;
    }

    function getCanvasSize() {
      if (isFullscreen()) {
        return document.body.clientWidth / 2 - 3;
      } else {
        return document.body.clientWidth / 2 - 20;
      }
    }

    function isFullscreen() {
      // This checks for fullscreen. document.addEventListener with 'fullscreenchange' doesn't work yet.
      return window.outerWidth === screen.width && window.outerHeight === screen.height;
    }

    function fillGlossary(ul, config) {
      Object.keys(config).forEach(function (key) {
        var li = document.createElement("li");

        var div = document.createElement("div");
        div.className = "glossaryBox";
        var color = config[key].color;
        div.style.backgroundColor = "rgb(" + color[0] + "," + color[1] + "," + color[2] + ")";

        var span = document.createElement("span");
        span.innerText = config[key].desc;

        li.appendChild(div);
        li.appendChild(span);
        ul.appendChild(li);
      });
    }
  </script>

</body>

</html>